version: '2.2.0.{build}'
image: Visual Studio 2017

assembly_info:
  patch: true
  file: AssemblyInfo.*
  assembly_version: "{version}"
  assembly_file_version: "{version}"
  assembly_informational_version: "{version}"
  
build:
  project: src/
  publish_nuget: true

branches:
  only:
  - master

init:
  - cmd: git config --global core.autocrlf true
  
before_build:
  - cmd: dotnet --version
  - cmd: dotnet clean
  - cmd: dotnet restore ./src --verbosity m
  - cmd: nuget restore .\src 
  
build_script:
  - cmd: dotnet pack -c release ./src/System.Net.IPNetwork
  - cmd: dotnet build -c release ./src/System.Net.IPNetwork.ConsoleApplication.NetFramework
  - cmd: dotnet build -c release ./src/System.Net.IPNetwork.ConsoleApplication.NetCore
  
test_script:
  - cmd: dotnet test ./src/System.Net.IPNetwork.TestProject.NetCore/System.Net.IPNetwork.TestProject.NetCore.csproj
  - vstest.console /logger:Appveyor c:\Projects\ipnetwork\src\System.Net.IPNetwork.TestProject.NetCore\bin\Debug\netcoreapp2.0\System.Net.IPNetwork.TestProject.NetCore.dll
 
deploy:
  provider: NuGet
  api_key:
    secure: Ct5Hb+2vmp8gYxa7RhnCJLa2MLxiPLZKmX49kFvUQtekPLgJtgUYXmDGsZ2Ln8Jg
  skip_symbols: false
  artifact: /.*\.nupkg/